#include <dt-bindings/zmk/matrix-transform.h>

/ {
    chosen {
        zmk,kscan = &kscan0;
        zmk,keyboard-transform = &sculpt_transform;
    };

    sculpt_transform: keymap_transform {
        compatible = "zmk,matrix-transform";

        // FIXME: this is a placeholder 2x2 matrix,
        // we'll expand it to full Sculpt later.
        rows = <2>;
        columns = <2>;

        map = <
            MATRIX_TRANSFORM_ENTRY(0, 0)  // key 0
            MATRIX_TRANSFORM_ENTRY(0, 1)  // key 1
            MATRIX_TRANSFORM_ENTRY(1, 0)  // key 2
            MATRIX_TRANSFORM_ENTRY(1, 1)  // key 3
        >;
    };
};

/* I2C bus on pro_micro (nice!nano) */
&pro_micro_i2c {
    status = "okay";

    pcf8575: gpio-expander@20 {
        compatible = "nxp,pcf8575";
        reg = <0x20>;
        #gpio-cells = <2>;
        gpio-controller;

        // INT pin from PCF8575 -> A1 on pro_micro (your wiring)
        int-gpios = <&pro_micro 19 GPIO_ACTIVE_LOW>;
    };
};

/* Keyboard scan configuration */
&pro_micro {
    kscan0: kscan {
        compatible = "zmk,kscan-gpio-matrix";
        label = "sculpt_kscan";

        // You likely have diodes oriented col->row but
        // confirm with the Sculpt docs. Adjust if needed.
        diode-direction = "col2row";

        // Rows: D4, D5, D6, D7, D8, D9, 10, 16
        row-gpios = <&pro_micro 4 GPIO_ACTIVE_HIGH>,
                    <&pro_micro 5 GPIO_ACTIVE_HIGH>,
                    <&pro_micro 6 GPIO_ACTIVE_HIGH>,
                    <&pro_micro 7 GPIO_ACTIVE_HIGH>,
                    <&pro_micro 8 GPIO_ACTIVE_HIGH>,
                    <&pro_micro 9 GPIO_ACTIVE_HIGH>,
                    <&pro_micro 10 GPIO_ACTIVE_HIGH>,
                    <&pro_micro 16 GPIO_ACTIVE_HIGH>;

        // Columns: Aâ€“P on PCF8575, Q/R on pro_micro 14/15
        col-gpios = <&pcf8575 0 GPIO_ACTIVE_HIGH>,  /* COL_A */
                    <&pcf8575 1 GPIO_ACTIVE_HIGH>,  /* COL_B */
                    <&pcf8575 2 GPIO_ACTIVE_HIGH>,  /* COL_C */
                    <&pcf8575 3 GPIO_ACTIVE_HIGH>,  /* COL_D */
                    <&pcf8575 4 GPIO_ACTIVE_HIGH>,  /* COL_E */
                    <&pcf8575 5 GPIO_ACTIVE_HIGH>,  /* COL_F */
                    <&pcf8575 6 GPIO_ACTIVE_HIGH>,  /* COL_G */
                    <&pcf8575 7 GPIO_ACTIVE_HIGH>,  /* COL_H */
                    <&pcf8575 8 GPIO_ACTIVE_HIGH>,  /* COL_I */
                    <&pcf8575 9 GPIO_ACTIVE_HIGH>,  /* COL_J */
                    <&pcf8575 10 GPIO_ACTIVE_HIGH>, /* COL_K */
                    <&pcf8575 11 GPIO_ACTIVE_HIGH>, /* COL_L */
                    <&pcf8575 12 GPIO_ACTIVE_HIGH>, /* COL_M */
                    <&pcf8575 13 GPIO_ACTIVE_HIGH>, /* COL_N */
                    <&pcf8575 14 GPIO_ACTIVE_HIGH>, /* COL_O */
                    <&pcf8575 15 GPIO_ACTIVE_HIGH>, /* COL_P */
                    <&pro_micro 14 GPIO_ACTIVE_HIGH>, /* COL_Q */
                    <&pro_micro 15 GPIO_ACTIVE_HIGH>; /* COL_R */
    };

    fn_switch: fn_switch {
        gpios = <&pro_micro 18 GPIO_ACTIVE_LOW>;
        // We'll bind this as a key later in the keymap.
    };
};
